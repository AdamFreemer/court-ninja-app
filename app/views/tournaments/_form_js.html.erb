<script>
  $(document).ready(function() { 
    // On load set court count to 1
    setDefaultCourtCount(<%= tournament.courts %>);
    // On load set session data
    setDefaultSessionData();
    // Show / hide courts according to players checked and update session data
    $("input:checkbox").change(function() { playersSelectedChange(); }); 
    // Update session data on tournament time changes
    tournyTimeChangeListener();
    tournyBreakTimeChangeListener();
    // Update page with current total tournament time
    updateTournyTimeOnPageListener();
  });

  function setDefaultSessionData() {
    localStorage['tournyTime'] = $('#tournament-time').val();
    localStorage['tournyBreakTime'] = $('#break-time').val();
    let pSelected = document.querySelectorAll('input[type="checkbox"]:checked').length;
    processPlayersSelected(pSelected);
  }

  function tournyTimeChangeListener() {
    $('#tournament-time').change(function () {
      localStorage['tournyTime'] = $('#tournament-time').val();
    });   
  }

  function tournyBreakTimeChangeListener() {
    $('#break-time').change(function () {
      localStorage['tournyBreakTime'] = $('#break-time').val();
    });       
  }

  function playersSelectedChange() {
    let pSelected = document.querySelectorAll('input[type="checkbox"]:checked').length;
    $('#players-label').text(`Players (${pSelected} selected)`);
    processPlayersSelected(pSelected);

    if (pSelected == 10 || pSelected == 11 || pSelected == 12 || pSelected == 13 || pSelected == 14 || pSelected == 15) {
      courtsCountTwo();
    } else {
      courtsCountOne();
    }    
  } 

  function processPlayersSelected(pSelected) {
    switch (pSelected) {
    case 0:
      localStorage['tournamentSets'] = 0
      localStorage['tournamentRounds'] = 1
      break;
    case 7:
      localStorage['tournamentSets'] = 7
      localStorage['tournamentRounds'] = 1
      break;
    case 8:
    case 9:
      localStorage['tournamentSets'] = 12
      localStorage['tournamentRounds'] = 1
      break;
    case 10:
      localStorage['tournamentSets'] = 5
      localStorage['tournamentRounds'] = 2
      break;
    case 11:
      localStorage['tournamentSets'] = 0
      localStorage['tournamentRounds'] = 1
      break;
    case 12:
    case 13:
    case 14:
    case 15:
    case 16:
      localStorage['tournamentSets'] = 7
      localStorage['tournamentRounds'] = 2
      break;
    }    
  }

  function updateTournyTimeOnPageListener() {
    $('#tournament-time, #break-time, input:checkbox').change(function () {
      updateTournyTimeOnPage();
    });      
  }

  function updateTournyTimeOnPage() {
    var tournyTime = parseFloat(localStorage['tournyTime']).toFixed(1);
    var tournyBreakTime = parseFloat(localStorage['tournyBreakTime']).toFixed(1);
    var tournamentSets = parseFloat(localStorage['tournamentSets']).toFixed(1);
    var tournamentRounds = parseFloat(localStorage['tournamentRounds']).toFixed(1);

    totalTourneyTime = ((tournyTime * tournamentSets) + ((tournamentSets - 1) * tournyBreakTime)) * tournamentRounds
    if (localStorage['tournamentSets'] == 0) {
      $('#tourny-time').text("--")
    } else {
      $('#tourny-time').text(totalTourneyTime + " minutes")
    }
  }  

  function selectNonePlayers() {
    let pSelected = document.querySelectorAll('input[type="checkbox"]:checked').length;
    processPlayersSelected(pSelected)

    var checkboxes = $( "[type=checkbox]" );
    checkboxes.prop('checked', $(this).is(':checked'));
    playersSelectedChange();
    updateTournyTimeOnPage();
    event.preventDefault();
  };

  function selectAllPlayers() {
    let pSelected = document.querySelectorAll('input[type="checkbox"]:checked').length;
    processPlayersSelected(pSelected)

    var checkboxes = $( "[type=checkbox]" );
    checkboxes.prop('checked', !$(this).is(':checked'));
    playersSelectedChange();
    updateTournyTimeOnPage();
    event.preventDefault();
  };

  function setDefaultCourtCount(courts_count) {
    if (courts_count == "1") {
      courtsCountOne();
    } else if (courts_count == "2") {
      courtsCountTwo();
    } else {
      courtsCountOne();
    }
  }  

  function courtsCountOne() {
    $("#court-1-container").show();
    $("#court-2-container").hide();
    $("#court-3-container").hide();
    $("#court-4-container").hide();
    $("#court-5-container").hide();
    $("#court-6-container").hide();
  };

  function courtsCountTwo() {
    $("#court-1-container").show();
    $("#court-2-container").show();
    $("#court-3-container").hide();
    $("#court-4-container").hide();
    $("#court-5-container").hide();
    $("#court-6-container").hide();
  };

  function courtsCountThree() {
    $("#court-1-container").show();
    $("#court-2-container").show();
    $("#court-3-container").show();
    $("#court-4-container").hide();
    $("#court-5-container").hide();
    $("#court-6-container").hide();
  };  

  function courtsCountFour() {
    $("#court-1-container").show();
    $("#court-2-container").show();
    $("#court-3-container").show();
    $("#court-4-container").show();
    $("#court-5-container").hide();
    $("#court-6-container").hide();
  };
</script>
