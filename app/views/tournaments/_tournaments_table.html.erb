<% if @tournaments %>
  <table id="tournamentsTable" class="min-w-full divide-y divide-gray-300">
    <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
        <% if current_user.is_admin == true %>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created By</th>
        <% end %>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Players</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Algorithm</th></th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Winner</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">&nbsp;</th>
        <th scope="col" class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">&nbsp;</th>
        <th scope="col" class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">&nbsp;</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
      <% @tournaments.each do |tournament| %>
        <tr class="bg-grey">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= tournament.id %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= tournament.created_at.strftime("%Y-%m-%d | %l:%M %p") %></td>
          <% if current_user.is_admin == true %>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= "#{tournament&.created_by&.full_name}, id: #{tournament&.created_by&.id}" if tournament&.created_by %></td>
          <% end %>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= tournament.name %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= tournament.players.count %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
            <% if tournament.tournament_completed %>
              <span class="text-green-600">Completed</span>
            <% elsif tournament.rounds_configured == [] %>
              <span class="text-red-600">Incomplete configuration</span>
            <% elsif !tournament.tournament_teams.collect(&:score).all? { |score| score.nil? } %>
              <span class="text-blue-600">In process</span>
            <% else %>
              <span class="text-gray-700">Created</span>
            <% end %>          
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
            <% if tournament.rounds_configured == [] %>
              <a href="<%= edit_tournament_path(tournament.id) %>">
                <button 
        class="text-md py-0.5 px-5 text-md font-medium text-blue-700 focus:outline-none bg-white rounded-full border-2 border-blue-700 hover:bg-gray-100 hover:text-red-700 focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-red-700 dark:border-gray-600 dark:hover:text-black dark:hover:bg-gray-200">
                  Click here to complete configuration
                </button>
              </a>            

            <% else %>
              <%= tournament.display_configuration %>
            <% end %>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              <%= tournament.winner_id == 0 ? '' : User.find(tournament.winner_id).name_abbreviated %>
          </td>
          <%= render "tournaments/tournaments_row_buttons", tournament: tournament %> 
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
 
<script>
  $(document).ready( function () {
    $('#tournamentsTable').dataTable( {
      columnDefs: [
        { orderable: false, targets: [0, 7] }
      ],      
      order: [[1, 'desc']],
      dom: 'rtf',
      pageLength: 250
    } );
  } );
</script> 
